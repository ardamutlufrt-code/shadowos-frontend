<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShadowOS â€” AI Instagram Analyzer</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="nav nav--glass">
    <div class="nav__left">
      <img src="logo.svg" alt="ShadowOS" class="logo" />
      <span class="brand">ShadowOS</span>
    </div>
    <div class="nav__right">
      <a href="dashboard.html" class="btn btn--ghost">Panele dÃ¶n</a>
    </div>
  </header>

  <main class="section">
    <div class="pageHeader">
      <div>
        <h1>AI Instagram Kanal Analizi</h1>
        <p class="muted">Sadece linki ver. NiÅŸi, konularÄ±, eksikleri, 3 paketli Ã¼rÃ¼nÃ¼ ve 30 gÃ¼nlÃ¼k iÃ§erik planÄ±nÄ± AI Ã§Ä±karsÄ±n.</p>
      </div>
    </div>

    <div class="card card--soft">
      <form id="analyzeForm" class="form">
        <label class="label">Instagram Linki</label>
        <input id="link" placeholder="https://instagram.com/kullaniciadi" required />
        <label class="label">AI Sunucu Adresi</label>
        <input id="apiBase" placeholder= https://shadowos-backend.onrender.com value=https://shadowos-backend.onrender.com
        <button class="btn btn--block" type="submit">AI ile Ä°ncele</button>
        <p class="muted tiny" style="margin-top:10px">
          Not: â€œÃ‡ok profesyonel + aynÄ± cevap yokâ€ iÃ§in analiz artÄ±k backendâ€™de OpenAI ile Ã¼retilir.
        </p>
      </form>
    </div>

    <div id="loading" class="card card--outline" style="display:none;margin-top:14px">
      <div class="kicker">â³ Ä°ÅŸleniyor</div>
      <h3>Shadow Operator Ã§alÄ±ÅŸÄ±yorâ€¦</h3>
      <p class="muted">Instagram meta verileri okunuyor ve AI analiz Ã¼retiyor. (10â€“30 sn sÃ¼rebilir)</p>
    </div>

    <div id="errorBox" class="card card--outline" style="display:none;margin-top:14px">
      <div class="kicker">âš ï¸ Hata</div>
      <h3>Ä°stek baÅŸarÄ±sÄ±z</h3>
      <p class="muted" id="errorText"></p>
    </div>

    <div id="output" style="display:none;margin-top:14px">
      <div class="grid2">
        <div class="card">
          <div class="kicker">ğŸ§  Tespit</div>
          <h3>NiÅŸ & Kitle</h3>
          <div id="detected" class="muted"></div>
        </div>
        <div class="card">
          <div class="kicker">ğŸ§© Eksikler</div>
          <h3>Gap Analizi</h3>
          <div id="gaps" class="muted"></div>
        </div>
      </div>

      <div class="card card--outline" style="margin-top:12px">
        <div class="kicker">ğŸ“š Konu KÃ¼meleri</div>
        <h3>Kanal hangi konularda iÃ§erik Ã¼retiyor?</h3>
        <div id="clusters" class="muted"></div>
      </div>

      <div class="card card--outline" style="margin-top:12px">
        <div class="kicker">ğŸ’¿ 3 Paketli Dijital ÃœrÃ¼n</div>
        <h3>Ucuz (PDF) â†’ Orta (Video) â†’ Premium (1:1)</h3>
        <div id="products" class="muted"></div>
      </div>

      <div class="card card--outline" style="margin-top:12px">
        <div class="kicker">ğŸ¥ 30 GÃ¼n Ä°Ã§erik PlanÄ±</div>
        <h3>BaÅŸlÄ±k + Hook + KÄ±sa senaryo + CTA</h3>
        <div id="plan" class="muted"></div>
      </div>
    </div>
  </main>

  <script>
    const userRaw = localStorage.getItem("shadowos_user");
    if(!userRaw){ window.location.href = "login.html"; }

    const $ = (id) => document.getElementById(id);

    function esc(s){
      return String(s ?? "").replace(/[&<>"']/g, (c) => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
    }

    function list(items){
      if(!Array.isArray(items) || items.length===0) return "<span class='muted'>â€”</span>";
      return "<ul>" + items.map(x => "<li>"+esc(x)+"</li>").join("") + "</ul>";
    }

    function render(data){
      const d = data || {};
      const audience = d.audience || {};
      const clusters = Array.isArray(d.topic_clusters) ? d.topic_clusters : [];
      const ladder = d.product_ladder || {};
      const plan = Array.isArray(d.content_plan_30d) ? d.content_plan_30d : [];

      $("detected").innerHTML = `
        <p><b>NiÅŸ:</b> ${esc(d.detected_niche || "â€”")}</p>
        <p><b>Kitle:</b> ${esc(audience.who || "â€”")}</p>
        <p><b>Seviye:</b> ${esc(audience.level || "â€”")}</p>
        <p><b>Ana aÄŸrÄ±lar:</b> ${list(audience.main_pain_points)}</p>
        <p><b>KonumlandÄ±rma:</b> ${esc(d.positioning_sentence || "â€”")}</p>
      `;

      $("gaps").innerHTML = list(d.missing_gaps);

      $("clusters").innerHTML = clusters.length
        ? "<div class='grid2'>" + clusters.map(c => `
            <div class='card card--soft'>
              <div class='kicker'>${esc(c.cluster)} â€¢ ${esc(c.weight_pct)}%</div>
              <div class='muted'>Ã–rnek aÃ§Ä±lar:${list(c.example_angles)}</div>
            </div>
          `).join("") + "</div>"
        : "<span class='muted'>â€”</span>";

      const entry = ladder.entry_pdf || {};
      const mid = ladder.mid_video || {};
      const prem = ladder.premium_1on1 || {};

      $("products").innerHTML = `
        <div class="grid3">
          <div class="card card--soft">
            <div class="kicker">ğŸŸ¢ GiriÅŸ (Ucuz)</div>
            <h4>${esc(entry.name || "PDF / Rehber")}</h4>
            <p class="muted small"><b>Fiyat:</b> ${esc(entry.price_range || "â€”")}</p>
            <div class="muted small"><b>Ä°Ã§erik:</b>${list(entry.deliverables)}</div>
            <div class="muted small"><b>Outline:</b>${list(entry.outline)}</div>
          </div>
          <div class="card card--soft">
            <div class="kicker">ğŸŸ¡ Orta (Video)</div>
            <h4>${esc(mid.name || "Video EÄŸitim")}</h4>
            <p class="muted small"><b>Fiyat:</b> ${esc(mid.price_range || "â€”")}</p>
            <div class="muted small"><b>ModÃ¼ller:</b>${
              Array.isArray(mid.modules) && mid.modules.length
                ? "<ul>"+mid.modules.map(m=>`<li><b>${esc(m.title)}</b> (${esc(m.minutes)} dk) â€” ${esc(m.outcome)}</li>`).join("")+"</ul>"
                : "<span class='muted'>â€”</span>"
            }</div>
            <div class="muted small"><b>Bonus:</b>${list(mid.bonuses)}</div>
          </div>
          <div class="card card--soft">
            <div class="kicker">ğŸ”´ Premium (1:1)</div>
            <h4>${esc(prem.name || "1:1 GÃ¶rÃ¼ÅŸme")}</h4>
            <p class="muted small"><b>Fiyat:</b> ${esc(prem.price_range || "â€”")}</p>
            <div class="muted small"><b>Kimin iÃ§in:</b>${list(prem.who_its_for)}</div>
            <p class="muted small"><b>Format:</b> ${esc(prem.format || "â€”")}</p>
            <div class="muted small"><b>GÃ¶rÃ¼ÅŸme akÄ±ÅŸÄ±:</b>${list(prem.call_structure)}</div>
          </div>
        </div>
      `;

      $("plan").innerHTML = plan.length
        ? "<div class='card card--soft'><div class='muted small'>Toplam: "+plan.length+" gÃ¼n</div></div>"
          + "<div style='margin-top:10px' class='grid2'>" + plan.slice(0, 30).map(p => `
              <div class="card card--soft">
                <div class="kicker">GÃ¼n ${esc(p.day)}</div>
                <h4>${esc(p.title)}</h4>
                <p class="muted small"><b>Hook:</b> ${esc(p.hook)}</p>
                <p class="muted small"><b>Senaryo:</b> ${esc(p.script)}</p>
                <p class="muted small"><b>CTA:</b> ${esc(p.cta)}</p>
              </div>
            `).join("") + "</div>"
        : "<span class='muted'>â€”</span>";
    }

    $("analyzeForm").addEventListener("submit", async function(e){
      e.preventDefault();
      $("errorBox").style.display = "none";
      $("output").style.display = "none";
      $("loading").style.display = "block";

      const url = $("link").value.trim();
      const apiBase = $("apiBase").value.trim().replace(/\/$/,"");

      try {
        const r = await fetch(apiBase + "/api/analyze", {
          method:"POST",
          headers: { "content-type":"application/json" },
          body: JSON.stringify({ url })
        });
        const j = await r.json();
        if(!r.ok){
          throw new Error(j?.error || "Bilinmeyen hata");
        }
        if(j?.data?.error){
          throw new Error(j.data.error);
        }
        render(j.data);
        $("loading").style.display = "none";
        $("output").style.display = "block";
      } catch(err){
        $("loading").style.display = "none";
        $("errorText").textContent = String(err?.message || err);
        $("errorBox").style.display = "block";
      }
    });
  </script>. <script>
  const params = new URLSearchParams(window.location.search);
  const paid = params.get("paid");

  if (paid === "true") {
    // Ã¶deme yapÄ±lmÄ±ÅŸsa analiz otomatik baÅŸlasÄ±n
    setTimeout(() => {
      const analyzeBtn = document.getElementById("analyze-btn");
      if (analyzeBtn) analyzeBtn.click();
    }, 1000);
  }
</script> <section id="payment-section" style="max-width:720px; margin:40px auto; padding:24px; border:1px solid #ddd; border-radius:12px;">
  <h2>ğŸ”’ KiÅŸiye Ã–zel Instagram Strateji Analizi</h2>

  <p>
    Instagram hesabÄ±n iÃ§in <strong>AI tarafÄ±ndan hazÄ±rlanmÄ±ÅŸ</strong>,
    tamamen sana Ã¶zel bir strateji raporu alÄ±yorsun.
  </p>

  <ul>
    <li>âœ”ï¸ Net niÅŸ tespiti</li>
    <li>âœ”ï¸ Ä°Ã§erik analizi (kanÄ±ta dayalÄ±)</li>
    <li>âœ”ï¸ Eksik kalan ama bÃ¼yÃ¼me getiren konular</li>
    <li>âœ”ï¸ 30 gÃ¼nlÃ¼k iÃ§erik planÄ±</li>
    <li>âœ”ï¸ Dijital Ã¼rÃ¼ne dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lebilir fikirler</li>
  </ul>

  <p><strong>ğŸ“„ Rapor PDF olarak teslim edilir.</strong></p>

  <p><strong>Fiyat: 149 TL (tek seferlik)</strong></p>

<a href='https://buy.stripe.com/test_bJe9ANbU97TQ8b487Q6Vq03'target="_blank">
 <a href="https://buy.stripe.com/test_dRmcMZ2jz4HE8b41Js6Vq04" target="_blank">
  <button style="padding:12px 20px; font-size:16px;">
    Analizi SatÄ±n Al ve PDFâ€™ini Al
  </button>
</a>

  <p style="font-size:12px; margin-top:12px; color:#666;">
    Bu rapor AI desteklidir, yÃ¶nlendirici niteliktedir.
  </p>
</section>
</body>
</html>
